{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{Box,Typography,Paper,TextField,Button,Container,Switch,FormControlLabel,Chip,Divider,IconButton,InputAdornment,Alert,Snackbar,MenuItem,Select,FormControl,InputLabel,Tooltip}from'@mui/material';import{AutoAwesome as AutoAwesomeIcon,Edit as EditIcon}from'@mui/icons-material';import{useParams}from'react-router-dom';import axios from'axios';import{useTheme}from'@mui/material/styles';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const LANGUAGE_OPTIONS=[{code:'ro',label:'Romanian'},{code:'en',label:'English'},{code:'ru',label:'Russian'},{code:'other',label:'Other...'}];const LANGUAGE_LABELS={ro:'Romanian',en:'English',ru:'Russian',other:'Other...'};const ConversationView=()=>{const{id}=useParams();const[profile,setProfile]=useState(null);const[messages,setMessages]=useState([]);const[input,setInput]=useState('');const[polishedMessage,setPolishedMessage]=useState('');const[aiReplies,setAiReplies]=useState({reply_1:'',reply_2:'',reply_3:''});const[autoAI,setAutoAI]=useState(false);const[nuclearFlirt,setNuclearFlirt]=useState(false);const[conversationGoal,setConversationGoal]=useState('');const[tonePreference,setTonePreference]=useState('');const[customTone,setCustomTone]=useState('');const[loading,setLoading]=useState(false);const[searchResults,setSearchResults]=useState([]);const[currentSearchIndex,setCurrentSearchIndex]=useState(-1);const[isSearching,setIsSearching]=useState(false);const[successMessage,setSuccessMessage]=useState('');const messagesEndRef=useRef(null);const lastMsgId=useRef('');const[selectedLanguage,setSelectedLanguage]=useState('en');const[customLanguage,setCustomLanguage]=useState('');const controlsRef=useRef(null);const[showScrollHint,setShowScrollHint]=useState(false);const theme=useTheme();const[geminiApiKey,setGeminiApiKey]=useState('');const[showApiKeyError,setShowApiKeyError]=useState(false);const navigate=useNavigate();const scrollToBottom=()=>{// Don't auto-scroll if user is actively searching\nif(!isSearching){var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});}};useEffect(()=>{// Only scroll to bottom if there are new messages (not on initial load)\nif(messages.length>0){scrollToBottom();}},[messages.length]);// Only trigger when message count changes, not on every message update\nuseEffect(()=>{fetchData();fetchSettings();const interval=setInterval(fetchData,3000);return()=>clearInterval(interval);},[id]);useEffect(()=>{if(!autoAI||messages.length===0)return;const lastMsg=messages[messages.length-1];if(lastMsg&&lastMsg.from!=='Me'&&lastMsg.text&&lastMsgId.current!==lastMsg.text){handleAIReply();lastMsgId.current=lastMsg.text;}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[messages,autoAI]);useEffect(()=>{const checkScroll=()=>{const el=controlsRef.current;if(!el)return;const isScrollable=el.scrollHeight>el.clientHeight;const notAtBottom=el.scrollTop+el.clientHeight<el.scrollHeight-24;setShowScrollHint(isScrollable&&notAtBottom);};checkScroll();const el=controlsRef.current;if(el){el.addEventListener('scroll',checkScroll);window.addEventListener('resize',checkScroll);}// Also check when content changes\nreturn()=>{if(el)el.removeEventListener('scroll',checkScroll);window.removeEventListener('resize',checkScroll);};},[profile,autoAI,nuclearFlirt,conversationGoal,tonePreference,customTone,selectedLanguage,customLanguage]);const fetchData=async()=>{try{var _profileRes$data$conv;const[profileRes,messagesRes]=await Promise.all([axios.get(`https://3e79a6ace678.ngrok-free.app/api/profiles/${id}`),axios.get(`https://3e79a6ace678.ngrok-free.app/api/conversations/${id}`)]);setProfile(profileRes.data);setMessages(messagesRes.data);setConversationGoal(((_profileRes$data$conv=profileRes.data.conversation_goals)===null||_profileRes$data$conv===void 0?void 0:_profileRes$data$conv[0])||'');setTonePreference(profileRes.data.tone_preference||'');}catch(error){console.error('Error fetching data:',error);}};const fetchSettings=async()=>{try{var _response$data$apiKey;const response=await axios.get('https://3e79a6ace678.ngrok-free.app/api/settings');setGeminiApiKey(((_response$data$apiKey=response.data.apiKeys)===null||_response$data$apiKey===void 0?void 0:_response$data$apiKey.geminiApiKey)||'');}catch(error){console.error('Error fetching settings:',error);}};const handleSearch=()=>{if(!searchTerm.trim()){setSearchResults([]);setCurrentSearchIndex(-1);setShowSearchResults(false);setIsSearching(false);return;}setIsSearching(true);const results=[];const searchLower=searchTerm.toLowerCase();messages.forEach((message,index)=>{if(message.text&&message.text.toLowerCase().includes(searchLower)){results.push({index,message,text:message.text,timestamp:message.timestamp});}});setSearchResults(results);setCurrentSearchIndex(results.length>0?0:-1);setShowSearchResults(results.length>0);};const handlePolish=async()=>{if(!input.trim()||!profile)return;if(!geminiApiKey){setShowApiKeyError(true);return;}setLoading(true);try{const language=selectedLanguage==='other'?customLanguage:LANGUAGE_LABELS[selectedLanguage];const response=await axios.post('https://3e79a6ace678.ngrok-free.app/api/ai/polish',{user_id:profile.user_id||id,message:input,tone:nuclearFlirt?'nuclear flirt':customTone||tonePreference,language});setPolishedMessage(response.data.polished||'Could not polish message');setInput(response.data.polished||input);// Insert polished message into input\n}catch(error){console.error('Error polishing message:',error);setPolishedMessage('Error polishing message');}finally{setLoading(false);}};const handleAIReply=async()=>{if(messages.length===0||!profile)return;if(!geminiApiKey){setShowApiKeyError(true);return;}const lastMessage=messages[messages.length-1];setLoading(true);try{const language=selectedLanguage==='other'?customLanguage:LANGUAGE_LABELS[selectedLanguage];const response=await axios.post('https://3e79a6ace678.ngrok-free.app/api/ai/reply',{user_id:profile.user_id||id,// Use profile.user_id if available, fallback to URL id\nlast_message:lastMessage.text,goal:conversationGoal,tone:nuclearFlirt?'nuclear flirt':customTone||tonePreference,language});setAiReplies(response.data);}catch(error){console.error('Error getting AI replies:',error);}finally{setLoading(false);}};const handleSendMessage=async()=>{if(!input.trim()||!profile)return;const messageText=input;setInput('');setLoading(true);try{// Add message to conversation\nawait axios.post(`https://3e79a6ace678.ngrok-free.app/api/conversations/${id}`,{from:'Me',text:messageText,timestamp:new Date().toLocaleString()});// Clear polished message after sending\nsetPolishedMessage('');// Refresh data to show new message\nfetchData();setSuccessMessage('Message sent successfully!');setTimeout(()=>setSuccessMessage(''),3000);}catch(error){console.error('Error sending message:',error);setSuccessMessage('Error sending message');setTimeout(()=>setSuccessMessage(''),3000);}finally{setLoading(false);}};const updateConversationGoal=async()=>{if(!profile)return;try{const updatedProfile={...profile};updatedProfile.conversation_goals=[conversationGoal];await axios.put(`https://3e79a6ace678.ngrok-free.app/api/profiles/${id}`,updatedProfile);setSuccessMessage('Conversation goal updated successfully!');setTimeout(()=>setSuccessMessage(''),3000);}catch(error){console.error('Error updating conversation goal:',error);}};const updateTonePreference=async()=>{if(!profile)return;try{const updatedProfile={...profile};updatedProfile.tone_preference=customTone||tonePreference;await axios.put(`https://3e79a6ace678.ngrok-free.app/api/profiles/${id}`,updatedProfile);setSuccessMessage('Tone preference updated successfully!');setTimeout(()=>setSuccessMessage(''),3000);}catch(error){console.error('Error updating tone preference:',error);}};if(!profile){return/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsx(Typography,{children:\"Loading...\"})});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Box,{sx:{width:'100vw',height:'calc(100vh - 80px)',display:'grid',gridTemplateColumns:{xs:'1fr',md:'1fr 380px',sm:'1fr 300px'},gap:2,padding:'8px',maxWidth:'100vw',boxSizing:'border-box',background:'none',fontFamily:'Inter, SF Pro Display, -apple-system, BlinkMacSystemFont, Segoe UI, sans-serif',color:'#1f2937'},children:[/*#__PURE__*/_jsxs(Box,{className:\"chat-section glass-element\",sx:{borderRadius:2,boxShadow:'0 2px 8px rgba(0,0,0,0.10)',display:'flex',flexDirection:'column',minHeight:0,height:'100%',p:2,overflow:'hidden'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",sx:{fontWeight:700,fontSize:{xs:20,md:24},mb:1,letterSpacing:'-0.01em',color:'#1f2937'},children:profile.name||profile.username||'Conversation'}),/*#__PURE__*/_jsxs(Box,{className:\"messages-area\",sx:{flex:1,overflowY:'auto',p:'0 8px 8px 8px',minHeight:0},children:[messages.map((message,index)=>/*#__PURE__*/_jsxs(Box,{id:`message-${index}`,sx:{mb:1.5,display:'flex',flexDirection:message.from==='Me'?'row-reverse':'row',alignItems:'flex-end',gap:1,position:'relative',transition:'all 0.3s'},children:[/*#__PURE__*/_jsx(Box,{sx:{minWidth:32,minHeight:32,display:'flex',alignItems:'center',justifyContent:'center'},children:/*#__PURE__*/_jsx(Paper,{elevation:1,sx:{width:32,height:32,borderRadius:'50%',background:message.from==='Me'?'#2563eb':'#e2e8f0',color:message.from==='Me'?'white':'#2563eb',display:'flex',alignItems:'center',justifyContent:'center',fontWeight:700,fontSize:16},children:message.from==='Me'?'ðŸ§‘':profile.name?profile.name[0]:'ðŸ¤–'})}),/*#__PURE__*/_jsxs(Box,{sx:{maxWidth:520,minWidth:60,px:2,py:1,borderRadius:message.from==='Me'?'12px 12px 4px 12px':'12px 12px 12px 4px',background:message.from==='Me'?'#2563eb':'#fff',color:message.from==='Me'?'white':'#1f2937',boxShadow:'0 2px 8px rgba(0,0,0,0.10)',position:'relative',fontSize:16,fontWeight:400,lineHeight:1.6,transition:'all 0.2s','&:hover .msg-actions':{opacity:1,pointerEvents:'auto'}},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body1\",sx:{fontSize:16,lineHeight:1.6,wordBreak:'break-word'},children:message.text}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",sx:{color:message.from==='Me'?'rgba(255,255,255,0.7)':'#6b7280',fontWeight:500,mt:0.5,display:'block',textAlign:message.from==='Me'?'right':'left',fontSize:12},children:message.timestamp}),/*#__PURE__*/_jsx(Box,{className:\"msg-actions\",sx:{position:'absolute',top:8,right:message.from==='Me'?8:'auto',left:message.from==='Me'?'auto':8,display:'flex',gap:1,opacity:0,pointerEvents:'none',transition:'opacity 0.2s'},children:/*#__PURE__*/_jsx(Tooltip,{title:\"Copy\",arrow:true,children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",tabIndex:-1,\"aria-label\":\"Copy message\",onClick:e=>{e.stopPropagation();navigator.clipboard.writeText(message.text);},children:/*#__PURE__*/_jsx(\"span\",{role:\"img\",\"aria-label\":\"Copy\",children:\"\\uD83D\\uDCCB\"})})})})]})]},index)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsxs(Box,{className:\"message-input-area glass-element\",sx:{flexShrink:0,p:2,borderTop:'1px solid #e5e7eb',display:'flex',gap:1.5,alignItems:'center',borderRadius:2},children:[/*#__PURE__*/_jsx(TextField,{className:\"message-input\",fullWidth:true,multiline:true,minRows:1,maxRows:4,value:input,onChange:e=>setInput(e.target.value),onKeyPress:e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handlePolish();}},placeholder:\"Type your message here... (Press Enter to polish)\",sx:{fontSize:16,borderRadius:1.5,background:'white',minHeight:40,padding:'8px 12px',border:'1px solid #e5e7eb',boxShadow:'0 2px 8px 0 rgba(0,0,0,0.03)','& .MuiOutlinedInput-root':{borderRadius:1.5},'& .Mui-focused .MuiOutlinedInput-notchedOutline':{borderColor:'#8b5cf6',boxShadow:'0 0 0 2px #8b5cf633'}},inputProps:{'aria-label':'Type your message'}}),/*#__PURE__*/_jsx(Button,{className:\"send-button\",variant:\"contained\",onClick:handlePolish,disabled:loading||!input.trim(),sx:{fontSize:14,fontWeight:500,height:40,padding:'8px 16px',background:'#8b5cf6',borderRadius:1.5,letterSpacing:'0.025em',minWidth:40,boxShadow:'0 4px 12px 0 rgba(108,99,255,0.08)',transition:'all 0.2s','&:hover':{filter:'brightness(1.08)',transform:'scale(1.02)'},outline:'none'},\"aria-label\":\"Polish message\",tabIndex:0,startIcon:/*#__PURE__*/_jsx(EditIcon,{}),children:\"Polish\"})]}),polishedMessage&&/*#__PURE__*/_jsxs(Box,{sx:{mt:1,mb:2,display:'flex',alignItems:'center',gap:1},children:[/*#__PURE__*/_jsx(Paper,{sx:{p:1.5,background:'#f3f4f6',borderRadius:2,flex:1},children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{color:'#1f2937'},children:polishedMessage})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Copy\",arrow:true,children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",\"aria-label\":\"Copy polished message\",onClick:()=>navigator.clipboard.writeText(polishedMessage),children:/*#__PURE__*/_jsx(\"span\",{role:\"img\",\"aria-label\":\"Copy\",children:\"\\uD83D\\uDCCB\"})})})]})]}),/*#__PURE__*/_jsxs(Box,{className:\"controls-sidebar glass-element\",ref:controlsRef,sx:{position:'relative',overflowY:'auto',height:'100%',minWidth:{xs:'100%',md:380,sm:300},p:2,pr:3,mr:2,display:'flex',flexDirection:'column',minHeight:0,borderRadius:2,...{// Custom scrollbar\n'&::-webkit-scrollbar':{width:6},'&::-webkit-scrollbar-track':{background:'#f1f5f9',borderRadius:3},'&::-webkit-scrollbar-thumb':{background:'#cbd5e1',borderRadius:3},'&::-webkit-scrollbar-thumb:hover':{background:'#94a3b8'}}},children:[/*#__PURE__*/_jsx(Box,{sx:{content:'\"\"',position:'absolute',bottom:0,left:0,right:0,height:40,background:'linear-gradient(transparent, rgba(255,255,255,0.9))',pointerEvents:'none',zIndex:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{fontWeight:600,fontSize:20,mb:2,color:'#1f2937'},children:\"Controls\"}),/*#__PURE__*/_jsx(Divider,{sx:{mb:2}}),/*#__PURE__*/_jsxs(Box,{sx:{mb:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",sx:{fontWeight:500,fontSize:16,mb:1},children:\"Message Settings\"}),/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"contained\",onClick:handleAIReply,disabled:loading,sx:{mb:1,borderRadius:2,fontWeight:500,fontSize:15,py:1,background:'#2563eb',color:'white',transition:'all 0.2s','&:hover':{filter:'brightness(1.08)',transform:'scale(1.02)'}},startIcon:/*#__PURE__*/_jsx(AutoAwesomeIcon,{}),children:\"Get AI Replies\"}),(aiReplies.reply_1||aiReplies.reply_2||aiReplies.reply_3)&&/*#__PURE__*/_jsx(Box,{sx:{mt:1,mb:2,display:'flex',flexDirection:'column',gap:1},children:[aiReplies.reply_1,aiReplies.reply_2,aiReplies.reply_3].filter(Boolean).map((reply,idx)=>/*#__PURE__*/_jsxs(Paper,{sx:{p:1.5,background:'#f3f4f6',borderRadius:2,display:'flex',alignItems:'center',gap:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{color:'#1f2937',flex:1},children:reply}),/*#__PURE__*/_jsx(Tooltip,{title:\"Copy\",arrow:true,children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",\"aria-label\":`Copy AI reply ${idx+1}`,onClick:()=>navigator.clipboard.writeText(reply),children:/*#__PURE__*/_jsx(\"span\",{role:\"img\",\"aria-label\":\"Copy\",children:\"\\uD83D\\uDCCB\"})})})]},idx))}),/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:autoAI,onChange:e=>setAutoAI(e.target.checked)}),label:\"Auto AI Replies\",sx:{mt:1}}),/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:nuclearFlirt,onChange:e=>setNuclearFlirt(e.target.checked)}),label:\"Nuclear Flirt Mode\",sx:{mt:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"#6b7280\",sx:{mt:1,display:'block'},children:\"Nuclear Flirt: Generates bold, high-risk flirty messages with maximum impact\"})]}),/*#__PURE__*/_jsx(Divider,{sx:{mb:2}}),/*#__PURE__*/_jsxs(Box,{sx:{mb:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",sx:{fontWeight:500,fontSize:16,mb:1},children:\"Conversation Controls\"}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,value:conversationGoal,onChange:e=>setConversationGoal(e.target.value),placeholder:\"Set conversation goal...\",sx:{mb:1,borderRadius:2},size:\"small\"}),/*#__PURE__*/_jsx(Button,{fullWidth:true,size:\"small\",onClick:updateConversationGoal,disabled:!conversationGoal.trim(),sx:{mb:2,borderRadius:2,fontWeight:500,fontSize:15,py:1,border:'2px solid #2563eb',color:'#2563eb',transition:'all 0.2s','&:hover':{background:'#e2e8f0',transform:'scale(1.02)'}},children:\"Update Goal\"}),/*#__PURE__*/_jsxs(TextField,{fullWidth:true,select:true,value:tonePreference,onChange:e=>setTonePreference(e.target.value),sx:{mb:1,borderRadius:2},size:\"small\",SelectProps:{displayEmpty:true,renderValue:selected=>selected?selected.charAt(0).toUpperCase()+selected.slice(1):'Select tone'},MenuProps:{PaperProps:{style:{maxHeight:200,overflow:'auto'}},anchorOrigin:{vertical:'bottom',horizontal:'left'},transformOrigin:{vertical:'top',horizontal:'left'}},children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:/*#__PURE__*/_jsx(\"em\",{children:\"Select tone\"})}),/*#__PURE__*/_jsx(MenuItem,{value:\"flirty\",children:\"Flirty\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"playful\",children:\"Playful\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"serious\",children:\"Serious\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"witty\",children:\"Witty\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"romantic\",children:\"Romantic\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"casual\",children:\"Casual\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"professional\",children:\"Professional\"})]}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,value:customTone,onChange:e=>setCustomTone(e.target.value),placeholder:\"Or type custom tone...\",sx:{mb:1,borderRadius:2},size:\"small\"}),/*#__PURE__*/_jsx(Button,{fullWidth:true,size:\"small\",onClick:updateTonePreference,disabled:!tonePreference.trim()&&!customTone.trim(),sx:{mb:1,borderRadius:2,fontWeight:500,fontSize:15,py:1,border:'2px solid #2563eb',color:'#2563eb',transition:'all 0.2s','&:hover':{background:'#e2e8f0',transform:'scale(1.02)'}},children:\"Update Tone\"}),(profile.tone_preference||customTone||tonePreference)&&/*#__PURE__*/_jsxs(Paper,{sx:{p:1.5,backgroundColor:'#2563eb',color:'white',mb:2,borderRadius:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"caption\",sx:{display:'block',mb:0.5},children:\"Current Tone:\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{fontWeight:'bold'},children:profile.tone_preference||customTone||tonePreference})]})]}),/*#__PURE__*/_jsx(Divider,{sx:{mb:2}}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",sx:{fontWeight:500,fontSize:16,mb:1},children:\"Advanced Options\"}),/*#__PURE__*/_jsxs(FormControl,{size:\"small\",sx:{minWidth:180,mb:2},children:[/*#__PURE__*/_jsx(InputLabel,{id:\"language-select-label\",children:\"Reply Language\"}),/*#__PURE__*/_jsx(Select,{labelId:\"language-select-label\",value:selectedLanguage,label:\"Reply Language\",onChange:e=>setSelectedLanguage(e.target.value),children:LANGUAGE_OPTIONS.map(opt=>/*#__PURE__*/_jsx(MenuItem,{value:opt.code,children:opt.label},opt.code))})]}),selectedLanguage==='other'&&/*#__PURE__*/_jsx(TextField,{size:\"small\",label:\"Custom Language\",value:customLanguage,onChange:e=>setCustomLanguage(e.target.value),sx:{minWidth:160,mb:2}})]})]}),showScrollHint&&/*#__PURE__*/_jsx(Box,{sx:{position:'absolute',bottom:16,right:24,zIndex:10,pointerEvents:'none'},children:/*#__PURE__*/_jsx(Box,{sx:{background:'rgba(37, 99, 235, 0.9)',color:'white',px:2,py:0.5,borderRadius:2,fontSize:12,fontWeight:500,animation:'bounce 2s infinite',boxShadow:'0 2px 8px rgba(0,0,0,0.12)',pointerEvents:'auto'},children:\"\\u2B07\\uFE0F More options below\"})}),/*#__PURE__*/_jsx(Snackbar,{open:!!successMessage,autoHideDuration:3000,onClose:()=>setSuccessMessage(''),anchorOrigin:{vertical:'bottom',horizontal:'left'},children:/*#__PURE__*/_jsx(Alert,{onClose:()=>setSuccessMessage(''),severity:\"success\",sx:{width:'100%'},children:successMessage})})]}),/*#__PURE__*/_jsx(Snackbar,{open:showApiKeyError,autoHideDuration:6000,onClose:()=>setShowApiKeyError(false),anchorOrigin:{vertical:'top',horizontal:'center'},children:/*#__PURE__*/_jsx(Alert,{elevation:6,variant:\"filled\",severity:\"error\",sx:{fontSize:18,alignItems:'center'},action:/*#__PURE__*/_jsx(Button,{color:\"inherit\",size:\"small\",onClick:()=>navigate('/settings'),children:\"Go to Settings\"}),children:\"AI features are unavailable. Please enter your Gemini API key in Settings (or check that your key is valid).\"})})]});};export default ConversationView;","map":{"version":3,"names":["React","useState","useEffect","useRef","Box","Typography","Paper","TextField","Button","Container","Switch","FormControlLabel","Chip","Divider","IconButton","InputAdornment","Alert","Snackbar","MenuItem","Select","FormControl","InputLabel","Tooltip","AutoAwesome","AutoAwesomeIcon","Edit","EditIcon","useParams","axios","useTheme","useNavigate","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","LANGUAGE_OPTIONS","code","label","LANGUAGE_LABELS","ro","en","ru","other","ConversationView","id","profile","setProfile","messages","setMessages","input","setInput","polishedMessage","setPolishedMessage","aiReplies","setAiReplies","reply_1","reply_2","reply_3","autoAI","setAutoAI","nuclearFlirt","setNuclearFlirt","conversationGoal","setConversationGoal","tonePreference","setTonePreference","customTone","setCustomTone","loading","setLoading","searchResults","setSearchResults","currentSearchIndex","setCurrentSearchIndex","isSearching","setIsSearching","successMessage","setSuccessMessage","messagesEndRef","lastMsgId","selectedLanguage","setSelectedLanguage","customLanguage","setCustomLanguage","controlsRef","showScrollHint","setShowScrollHint","theme","geminiApiKey","setGeminiApiKey","showApiKeyError","setShowApiKeyError","navigate","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","length","fetchData","fetchSettings","interval","setInterval","clearInterval","lastMsg","from","text","handleAIReply","checkScroll","el","isScrollable","scrollHeight","clientHeight","notAtBottom","scrollTop","addEventListener","window","removeEventListener","_profileRes$data$conv","profileRes","messagesRes","Promise","all","get","data","conversation_goals","tone_preference","error","console","_response$data$apiKey","response","apiKeys","handleSearch","searchTerm","trim","setShowSearchResults","results","searchLower","toLowerCase","forEach","message","index","includes","push","timestamp","handlePolish","language","post","user_id","tone","polished","lastMessage","last_message","goal","handleSendMessage","messageText","Date","toLocaleString","setTimeout","updateConversationGoal","updatedProfile","put","updateTonePreference","children","sx","width","height","display","gridTemplateColumns","xs","md","sm","gap","padding","maxWidth","boxSizing","background","fontFamily","color","className","borderRadius","boxShadow","flexDirection","minHeight","p","overflow","variant","fontWeight","fontSize","mb","letterSpacing","name","username","flex","overflowY","map","alignItems","position","transition","minWidth","justifyContent","elevation","px","py","lineHeight","opacity","pointerEvents","wordBreak","mt","textAlign","top","right","left","title","arrow","size","tabIndex","onClick","e","stopPropagation","navigator","clipboard","writeText","role","ref","flexShrink","borderTop","fullWidth","multiline","minRows","maxRows","value","onChange","target","onKeyPress","key","shiftKey","preventDefault","placeholder","border","borderColor","inputProps","disabled","filter","transform","outline","startIcon","pr","mr","content","bottom","zIndex","Boolean","reply","idx","control","checked","select","SelectProps","displayEmpty","renderValue","selected","charAt","toUpperCase","slice","MenuProps","PaperProps","style","maxHeight","anchorOrigin","vertical","horizontal","transformOrigin","backgroundColor","labelId","opt","animation","open","autoHideDuration","onClose","severity","action"],"sources":["/workspace/frontend/src/pages/ConversationView.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport {\n  Box,\n  Typography,\n  Paper,\n  TextField,\n  Button,\n  Container,\n  Switch,\n  FormControlLabel,\n  Chip,\n  Divider,\n  IconButton,\n  InputAdornment,\n  Alert,\n  Snackbar,\n  MenuItem,\n  Select,\n  FormControl,\n  InputLabel,\n  Tooltip,\n} from '@mui/material';\nimport {\n  AutoAwesome as AutoAwesomeIcon,\n  Edit as EditIcon\n} from '@mui/icons-material';\nimport { useParams } from 'react-router-dom';\nimport axios from 'axios';\nimport { useTheme } from '@mui/material/styles';\nimport { useNavigate } from 'react-router-dom';\n\nconst LANGUAGE_OPTIONS = [\n  { code: 'ro', label: 'Romanian' },\n  { code: 'en', label: 'English' },\n  { code: 'ru', label: 'Russian' },\n  { code: 'other', label: 'Other...' },\n];\n\nconst LANGUAGE_LABELS = {\n  ro: 'Romanian',\n  en: 'English',\n  ru: 'Russian',\n  other: 'Other...'\n};\n\nconst ConversationView = () => {\n  const { id } = useParams();\n  const [profile, setProfile] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [polishedMessage, setPolishedMessage] = useState('');\n  const [aiReplies, setAiReplies] = useState({ reply_1: '', reply_2: '', reply_3: '' });\n  const [autoAI, setAutoAI] = useState(false);\n  const [nuclearFlirt, setNuclearFlirt] = useState(false);\n  const [conversationGoal, setConversationGoal] = useState('');\n  const [tonePreference, setTonePreference] = useState('');\n  const [customTone, setCustomTone] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [searchResults, setSearchResults] = useState([]);\n  const [currentSearchIndex, setCurrentSearchIndex] = useState(-1);\n  const [isSearching, setIsSearching] = useState(false);\n  const [successMessage, setSuccessMessage] = useState('');\n  const messagesEndRef = useRef(null);\n  const lastMsgId = useRef('');\n  const [selectedLanguage, setSelectedLanguage] = useState('en');\n  const [customLanguage, setCustomLanguage] = useState('');\n  const controlsRef = useRef(null);\n  const [showScrollHint, setShowScrollHint] = useState(false);\n  const theme = useTheme();\n  const [geminiApiKey, setGeminiApiKey] = useState('');\n  const [showApiKeyError, setShowApiKeyError] = useState(false);\n  const navigate = useNavigate();\n\n  const scrollToBottom = () => {\n    // Don't auto-scroll if user is actively searching\n    if (!isSearching) {\n      messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n    }\n  };\n\n  useEffect(() => {\n    // Only scroll to bottom if there are new messages (not on initial load)\n    if (messages.length > 0) {\n      scrollToBottom();\n    }\n  }, [messages.length]); // Only trigger when message count changes, not on every message update\n\n  useEffect(() => {\n    fetchData();\n    fetchSettings();\n    const interval = setInterval(fetchData, 3000);\n    return () => clearInterval(interval);\n  }, [id]);\n\n  useEffect(() => {\n    if (!autoAI || messages.length === 0) return;\n    const lastMsg = messages[messages.length - 1];\n    if (lastMsg && lastMsg.from !== 'Me' && lastMsg.text && lastMsgId.current !== lastMsg.text) {\n      handleAIReply();\n      lastMsgId.current = lastMsg.text;\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [messages, autoAI]);\n\n  useEffect(() => {\n    const checkScroll = () => {\n      const el = controlsRef.current;\n      if (!el) return;\n      const isScrollable = el.scrollHeight > el.clientHeight;\n      const notAtBottom = el.scrollTop + el.clientHeight < el.scrollHeight - 24;\n      setShowScrollHint(isScrollable && notAtBottom);\n    };\n    checkScroll();\n    const el = controlsRef.current;\n    if (el) {\n      el.addEventListener('scroll', checkScroll);\n      window.addEventListener('resize', checkScroll);\n    }\n    // Also check when content changes\n    return () => {\n      if (el) el.removeEventListener('scroll', checkScroll);\n      window.removeEventListener('resize', checkScroll);\n    };\n  }, [profile, autoAI, nuclearFlirt, conversationGoal, tonePreference, customTone, selectedLanguage, customLanguage]);\n\n  const fetchData = async () => {\n    try {\n      const [profileRes, messagesRes] = await Promise.all([\n        axios.get(`https://3e79a6ace678.ngrok-free.app/api/profiles/${id}`),\n        axios.get(`https://3e79a6ace678.ngrok-free.app/api/conversations/${id}`)\n      ]);\n      setProfile(profileRes.data);\n      setMessages(messagesRes.data);\n      setConversationGoal(profileRes.data.conversation_goals?.[0] || '');\n      setTonePreference(profileRes.data.tone_preference || '');\n    } catch (error) {\n      console.error('Error fetching data:', error);\n    }\n  };\n\n  const fetchSettings = async () => {\n    try {\n      const response = await axios.get('https://3e79a6ace678.ngrok-free.app/api/settings');\n      setGeminiApiKey(response.data.apiKeys?.geminiApiKey || '');\n    } catch (error) {\n      console.error('Error fetching settings:', error);\n    }\n  };\n\n  const handleSearch = () => {\n    if (!searchTerm.trim()) {\n      setSearchResults([]);\n      setCurrentSearchIndex(-1);\n      setShowSearchResults(false);\n      setIsSearching(false);\n      return;\n    }\n\n    setIsSearching(true);\n    const results = [];\n    const searchLower = searchTerm.toLowerCase();\n    \n    messages.forEach((message, index) => {\n      if (message.text && message.text.toLowerCase().includes(searchLower)) {\n        results.push({\n          index,\n          message,\n          text: message.text,\n          timestamp: message.timestamp\n        });\n      }\n    });\n\n    setSearchResults(results);\n    setCurrentSearchIndex(results.length > 0 ? 0 : -1);\n    setShowSearchResults(results.length > 0);\n  };\n\n\n\n  const handlePolish = async () => {\n    if (!input.trim() || !profile) return;\n    if (!geminiApiKey) {\n      setShowApiKeyError(true);\n      return;\n    }\n    setLoading(true);\n    try {\n      const language = selectedLanguage === 'other' ? customLanguage : LANGUAGE_LABELS[selectedLanguage];\n      const response = await axios.post('https://3e79a6ace678.ngrok-free.app/api/ai/polish', {\n        user_id: profile.user_id || id,\n        message: input,\n        tone: nuclearFlirt ? 'nuclear flirt' : (customTone || tonePreference),\n        language,\n      });\n      setPolishedMessage(response.data.polished || 'Could not polish message');\n      setInput(response.data.polished || input); // Insert polished message into input\n    } catch (error) {\n      console.error('Error polishing message:', error);\n      setPolishedMessage('Error polishing message');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleAIReply = async () => {\n    if (messages.length === 0 || !profile) return;\n    if (!geminiApiKey) {\n      setShowApiKeyError(true);\n      return;\n    }\n    const lastMessage = messages[messages.length - 1];\n    setLoading(true);\n    try {\n      const language = selectedLanguage === 'other' ? customLanguage : LANGUAGE_LABELS[selectedLanguage];\n      const response = await axios.post('https://3e79a6ace678.ngrok-free.app/api/ai/reply', {\n        user_id: profile.user_id || id, // Use profile.user_id if available, fallback to URL id\n        last_message: lastMessage.text,\n        goal: conversationGoal,\n        tone: nuclearFlirt ? 'nuclear flirt' : (customTone || tonePreference),\n        language,\n      });\n      setAiReplies(response.data);\n    } catch (error) {\n      console.error('Error getting AI replies:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSendMessage = async () => {\n    if (!input.trim() || !profile) return;\n    \n    const messageText = input;\n    setInput('');\n    setLoading(true);\n    \n    try {\n      // Add message to conversation\n      await axios.post(`https://3e79a6ace678.ngrok-free.app/api/conversations/${id}`, {\n        from: 'Me',\n        text: messageText,\n        timestamp: new Date().toLocaleString()\n      });\n      \n      // Clear polished message after sending\n      setPolishedMessage('');\n      \n      // Refresh data to show new message\n      fetchData();\n      \n      setSuccessMessage('Message sent successfully!');\n      setTimeout(() => setSuccessMessage(''), 3000);\n    } catch (error) {\n      console.error('Error sending message:', error);\n      setSuccessMessage('Error sending message');\n      setTimeout(() => setSuccessMessage(''), 3000);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const updateConversationGoal = async () => {\n    if (!profile) return;\n    try {\n      const updatedProfile = { ...profile };\n      updatedProfile.conversation_goals = [conversationGoal];\n      await axios.put(`https://3e79a6ace678.ngrok-free.app/api/profiles/${id}`, updatedProfile);\n      setSuccessMessage('Conversation goal updated successfully!');\n      setTimeout(() => setSuccessMessage(''), 3000);\n    } catch (error) {\n      console.error('Error updating conversation goal:', error);\n    }\n  };\n\n  const updateTonePreference = async () => {\n    if (!profile) return;\n    try {\n      const updatedProfile = { ...profile };\n      updatedProfile.tone_preference = customTone || tonePreference;\n      await axios.put(`https://3e79a6ace678.ngrok-free.app/api/profiles/${id}`, updatedProfile);\n      setSuccessMessage('Tone preference updated successfully!');\n      setTimeout(() => setSuccessMessage(''), 3000);\n    } catch (error) {\n      console.error('Error updating tone preference:', error);\n    }\n  };\n\n  if (!profile) {\n    return (\n      <Container>\n        <Typography>Loading...</Typography>\n      </Container>\n    );\n  }\n\n  return (\n    <>\n    <Box sx={{\n      width: '100vw',\n      height: 'calc(100vh - 80px)',\n      display: 'grid',\n      gridTemplateColumns: { xs: '1fr', md: '1fr 380px', sm: '1fr 300px' },\n      gap: 2,\n      padding: '8px',\n      maxWidth: '100vw',\n      boxSizing: 'border-box',\n      background: 'none',\n      fontFamily: 'Inter, SF Pro Display, -apple-system, BlinkMacSystemFont, Segoe UI, sans-serif',\n      color: '#1f2937',\n    }}>\n      {/* Chat Section */}\n      <Box className=\"chat-section glass-element\" sx={{\n        borderRadius: 2,\n        boxShadow: '0 2px 8px rgba(0,0,0,0.10)',\n        display: 'flex',\n        flexDirection: 'column',\n        minHeight: 0,\n        height: '100%',\n        p: 2,\n        overflow: 'hidden',\n      }}>\n        <Typography variant=\"h4\" sx={{ fontWeight: 700, fontSize: { xs: 20, md: 24 }, mb: 1, letterSpacing: '-0.01em', color: '#1f2937' }}>\n        {profile.name || profile.username || 'Conversation'}\n      </Typography>\n        <Box className=\"messages-area\" sx={{ flex: 1, overflowY: 'auto', p: '0 8px 8px 8px', minHeight: 0 }}>\n              {messages.map((message, index) => (\n                <Box\n                  key={index}\n                  id={`message-${index}`}\n                  sx={{\n                mb: 1.5,\n                    display: 'flex',\n                flexDirection: message.from === 'Me' ? 'row-reverse' : 'row',\n                alignItems: 'flex-end',\n                gap: 1,\n                position: 'relative',\n                transition: 'all 0.3s',\n              }}\n            >\n              {/* Avatar/Initials */}\n              <Box sx={{ minWidth: 32, minHeight: 32, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\n                <Paper elevation={1} sx={{ width: 32, height: 32, borderRadius: '50%', background: message.from === 'Me' ? '#2563eb' : '#e2e8f0', color: message.from === 'Me' ? 'white' : '#2563eb', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: 700, fontSize: 16 }}>\n                  {message.from === 'Me' ? 'ðŸ§‘' : (profile.name ? profile.name[0] : 'ðŸ¤–')}\n                </Paper>\n              </Box>\n              {/* Message Bubble */}\n              <Box\n                    sx={{\n                  maxWidth: 520,\n                  minWidth: 60,\n                  px: 2,\n                  py: 1,\n                  borderRadius: message.from === 'Me' ? '12px 12px 4px 12px' : '12px 12px 12px 4px',\n                  background: message.from === 'Me' ? '#2563eb' : '#fff',\n                  color: message.from === 'Me' ? 'white' : '#1f2937',\n                  boxShadow: '0 2px 8px rgba(0,0,0,0.10)',\n                  position: 'relative',\n                  fontSize: 16,\n                  fontWeight: 400,\n                  lineHeight: 1.6,\n                  transition: 'all 0.2s',\n                  '&:hover .msg-actions': { opacity: 1, pointerEvents: 'auto' },\n                }}\n              >\n                <Typography variant=\"body1\" sx={{ fontSize: 16, lineHeight: 1.6, wordBreak: 'break-word' }}>{message.text}</Typography>\n                <Typography variant=\"caption\" sx={{ color: message.from === 'Me' ? 'rgba(255,255,255,0.7)' : '#6b7280', fontWeight: 500, mt: 0.5, display: 'block', textAlign: message.from === 'Me' ? 'right' : 'left', fontSize: 12 }}>{message.timestamp}</Typography>\n                {/* Quick Actions (copy, edit, regenerate) */}\n                <Box className=\"msg-actions\" sx={{ position: 'absolute', top: 8, right: message.from === 'Me' ? 8 : 'auto', left: message.from === 'Me' ? 'auto' : 8, display: 'flex', gap: 1, opacity: 0, pointerEvents: 'none', transition: 'opacity 0.2s' }}>\n                  <Tooltip title=\"Copy\" arrow><IconButton size=\"small\" tabIndex={-1} aria-label=\"Copy message\" onClick={e => { e.stopPropagation(); navigator.clipboard.writeText(message.text); }}><span role=\"img\" aria-label=\"Copy\">ðŸ“‹</span></IconButton></Tooltip>\n                </Box>\n              </Box>\n                </Box>\n              ))}\n              <div ref={messagesEndRef} />\n            </Box>\n        {/* Message Input */}\n        <Box className=\"message-input-area glass-element\" sx={{\n          flexShrink: 0,\n          p: 2,\n          borderTop: '1px solid #e5e7eb',\n          display: 'flex',\n          gap: 1.5,\n          alignItems: 'center',\n          borderRadius: 2,\n        }}>\n            <TextField\n            className=\"message-input\"\n              fullWidth\n              multiline\n            minRows={1}\n            maxRows={4}\n              value={input}\n              onChange={(e) => setInput(e.target.value)}\n            onKeyPress={(e) => {\n              if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                handlePolish();\n              }\n            }}\n            placeholder=\"Type your message here... (Press Enter to polish)\"\n            sx={{\n              fontSize: 16,\n              borderRadius: 1.5,\n              background: 'white',\n              minHeight: 40,\n              padding: '8px 12px',\n              border: '1px solid #e5e7eb',\n              boxShadow: '0 2px 8px 0 rgba(0,0,0,0.03)',\n              '& .MuiOutlinedInput-root': {\n                borderRadius: 1.5,\n              },\n              '& .Mui-focused .MuiOutlinedInput-notchedOutline': {\n                borderColor: '#8b5cf6',\n                boxShadow: '0 0 0 2px #8b5cf633',\n              },\n            }}\n            inputProps={{ 'aria-label': 'Type your message' }}\n            />\n            <Button\n            className=\"send-button\"\n            variant=\"contained\"\n              onClick={handlePolish}\n              disabled={loading || !input.trim()}\n            sx={{\n              fontSize: 14,\n              fontWeight: 500,\n              height: 40,\n              padding: '8px 16px',\n              background: '#8b5cf6',\n              borderRadius: 1.5,\n              letterSpacing: '0.025em',\n              minWidth: 40,\n              boxShadow: '0 4px 12px 0 rgba(108,99,255,0.08)',\n              transition: 'all 0.2s',\n              '&:hover': { filter: 'brightness(1.08)', transform: 'scale(1.02)' },\n              outline: 'none',\n            }}\n            aria-label=\"Polish message\"\n            tabIndex={0}\n            startIcon={<EditIcon />}\n          >\n            Polish\n            </Button>\n        </Box>\n        {/* Show polished message below input if available */}\n            {polishedMessage && (\n          <Box sx={{ mt: 1, mb: 2, display: 'flex', alignItems: 'center', gap: 1 }}>\n            <Paper sx={{ p: 1.5, background: '#f3f4f6', borderRadius: 2, flex: 1 }}>\n              <Typography variant=\"body2\" sx={{ color: '#1f2937' }}>{polishedMessage}</Typography>\n              </Paper>\n            <Tooltip title=\"Copy\" arrow>\n              <IconButton size=\"small\" aria-label=\"Copy polished message\" onClick={() => navigator.clipboard.writeText(polishedMessage)}>\n                <span role=\"img\" aria-label=\"Copy\">ðŸ“‹</span>\n              </IconButton>\n            </Tooltip>\n          </Box>\n        )}\n      </Box>\n      {/* Controls Section */}\n      <Box className=\"controls-sidebar glass-element\" ref={controlsRef} sx={{\n        position: 'relative',\n        overflowY: 'auto',\n        height: '100%',\n        minWidth: { xs: '100%', md: 380, sm: 300 },\n        p: 2,\n        pr: 3,\n        mr: 2,\n        display: 'flex',\n        flexDirection: 'column',\n        minHeight: 0,\n        borderRadius: 2,\n        ...{\n          // Custom scrollbar\n          '&::-webkit-scrollbar': { width: 6 },\n          '&::-webkit-scrollbar-track': { background: '#f1f5f9', borderRadius: 3 },\n          '&::-webkit-scrollbar-thumb': { background: '#cbd5e1', borderRadius: 3 },\n          '&::-webkit-scrollbar-thumb:hover': { background: '#94a3b8' },\n        }\n      }}>\n        {/* Fade gradient at bottom for scroll indicator */}\n        <Box sx={{\n          content: '\"\"',\n          position: 'absolute',\n          bottom: 0,\n          left: 0,\n          right: 0,\n          height: 40,\n          background: 'linear-gradient(transparent, rgba(255,255,255,0.9))',\n          pointerEvents: 'none',\n          zIndex: 1,\n        }} />\n        {/* Collapsible sections (Message Settings, Conversation Controls, Advanced Options) */}\n        <Typography variant=\"h6\" sx={{ fontWeight: 600, fontSize: 20, mb: 2, color: '#1f2937' }}>Controls</Typography>\n        <Divider sx={{ mb: 2 }} />\n        {/* Message Settings */}\n        <Box sx={{ mb: 3 }}>\n          <Typography variant=\"subtitle1\" sx={{ fontWeight: 500, fontSize: 16, mb: 1 }}>Message Settings</Typography>\n            <Button\n              fullWidth\n              variant=\"contained\"\n              onClick={handleAIReply}\n              disabled={loading}\n            sx={{ mb: 1, borderRadius: 2, fontWeight: 500, fontSize: 15, py: 1, background: '#2563eb', color: 'white', transition: 'all 0.2s', '&:hover': { filter: 'brightness(1.08)', transform: 'scale(1.02)' } }}\n            startIcon={<AutoAwesomeIcon />}\n            >\n              Get AI Replies\n            </Button>\n          {/* Show AI replies if available */}\n          {(aiReplies.reply_1 || aiReplies.reply_2 || aiReplies.reply_3) && (\n            <Box sx={{ mt: 1, mb: 2, display: 'flex', flexDirection: 'column', gap: 1 }}>\n              {[aiReplies.reply_1, aiReplies.reply_2, aiReplies.reply_3].filter(Boolean).map((reply, idx) => (\n                <Paper key={idx} sx={{ p: 1.5, background: '#f3f4f6', borderRadius: 2, display: 'flex', alignItems: 'center', gap: 1 }}>\n                  <Typography variant=\"body2\" sx={{ color: '#1f2937', flex: 1 }}>{reply}</Typography>\n                  <Tooltip title=\"Copy\" arrow>\n                    <IconButton size=\"small\" aria-label={`Copy AI reply ${idx + 1}`} onClick={() => navigator.clipboard.writeText(reply)}>\n                      <span role=\"img\" aria-label=\"Copy\">ðŸ“‹</span>\n                    </IconButton>\n                  </Tooltip>\n                </Paper>\n              ))}\n              </Box>\n            )}\n          <FormControlLabel\n            control={<Switch checked={autoAI} onChange={(e) => setAutoAI(e.target.checked)} />}\n            label=\"Auto AI Replies\"\n            sx={{ mt: 1 }}\n          />\n          <FormControlLabel\n            control={<Switch checked={nuclearFlirt} onChange={(e) => setNuclearFlirt(e.target.checked)} />}\n            label=\"Nuclear Flirt Mode\"\n            sx={{ mt: 1 }}\n          />\n          <Typography variant=\"caption\" color=\"#6b7280\" sx={{ mt: 1, display: 'block' }}>\n            Nuclear Flirt: Generates bold, high-risk flirty messages with maximum impact\n          </Typography>\n              </Box>\n        <Divider sx={{ mb: 2 }} />\n        {/* Conversation Controls */}\n        <Box sx={{ mb: 3 }}>\n          <Typography variant=\"subtitle1\" sx={{ fontWeight: 500, fontSize: 16, mb: 1 }}>Conversation Controls</Typography>\n            <TextField\n              fullWidth\n              value={conversationGoal}\n              onChange={(e) => setConversationGoal(e.target.value)}\n              placeholder=\"Set conversation goal...\"\n            sx={{ mb: 1, borderRadius: 2 }}\n            size=\"small\"\n            />\n            <Button\n              fullWidth\n              size=\"small\"\n              onClick={updateConversationGoal}\n              disabled={!conversationGoal.trim()}\n            sx={{ mb: 2, borderRadius: 2, fontWeight: 500, fontSize: 15, py: 1, border: '2px solid #2563eb', color: '#2563eb', transition: 'all 0.2s', '&:hover': { background: '#e2e8f0', transform: 'scale(1.02)' } }}\n            >\n              Update Goal\n            </Button>\n            <TextField\n              fullWidth\n              select\n              value={tonePreference}\n              onChange={(e) => setTonePreference(e.target.value)}\n            sx={{ mb: 1, borderRadius: 2 }}\n            size=\"small\"\n            SelectProps={{\n              displayEmpty: true,\n              renderValue: (selected) => selected ? selected.charAt(0).toUpperCase() + selected.slice(1) : 'Select tone',\n            }}\n              MenuProps={{\n              PaperProps: { style: { maxHeight: 200, overflow: 'auto' } },\n              anchorOrigin: { vertical: 'bottom', horizontal: 'left' },\n              transformOrigin: { vertical: 'top', horizontal: 'left' }\n            }}\n          >\n            <MenuItem value=\"\"><em>Select tone</em></MenuItem>\n            <MenuItem value=\"flirty\">Flirty</MenuItem>\n            <MenuItem value=\"playful\">Playful</MenuItem>\n            <MenuItem value=\"serious\">Serious</MenuItem>\n            <MenuItem value=\"witty\">Witty</MenuItem>\n            <MenuItem value=\"romantic\">Romantic</MenuItem>\n            <MenuItem value=\"casual\">Casual</MenuItem>\n            <MenuItem value=\"professional\">Professional</MenuItem>\n            </TextField>\n            <TextField\n              fullWidth\n              value={customTone}\n              onChange={(e) => setCustomTone(e.target.value)}\n              placeholder=\"Or type custom tone...\"\n            sx={{ mb: 1, borderRadius: 2 }}\n            size=\"small\"\n            />\n            <Button\n              fullWidth\n              size=\"small\"\n              onClick={updateTonePreference}\n              disabled={!tonePreference.trim() && !customTone.trim()}\n            sx={{ mb: 1, borderRadius: 2, fontWeight: 500, fontSize: 15, py: 1, border: '2px solid #2563eb', color: '#2563eb', transition: 'all 0.2s', '&:hover': { background: '#e2e8f0', transform: 'scale(1.02)' } }}\n            >\n              Update Tone\n            </Button>\n            {(profile.tone_preference || customTone || tonePreference) && (\n            <Paper sx={{ p: 1.5, backgroundColor: '#2563eb', color: 'white', mb: 2, borderRadius: 2 }}>\n                <Typography variant=\"caption\" sx={{ display: 'block', mb: 0.5 }}>\n                  Current Tone:\n                </Typography>\n                <Typography variant=\"body2\" sx={{ fontWeight: 'bold' }}>\n                  {profile.tone_preference || customTone || tonePreference}\n                </Typography>\n              </Paper>\n            )}\n        </Box>\n        <Divider sx={{ mb: 2 }} />\n        {/* Advanced Options */}\n        <Box>\n          <Typography variant=\"subtitle1\" sx={{ fontWeight: 500, fontSize: 16, mb: 1 }}>Advanced Options</Typography>\n          <FormControl size=\"small\" sx={{ minWidth: 180, mb: 2 }}>\n            <InputLabel id=\"language-select-label\">Reply Language</InputLabel>\n            <Select\n              labelId=\"language-select-label\"\n              value={selectedLanguage}\n              label=\"Reply Language\"\n              onChange={e => setSelectedLanguage(e.target.value)}\n            >\n              {LANGUAGE_OPTIONS.map(opt => (\n                <MenuItem key={opt.code} value={opt.code}>{opt.label}</MenuItem>\n              ))}\n            </Select>\n          </FormControl>\n          {selectedLanguage === 'other' && (\n            <TextField\n              size=\"small\"\n              label=\"Custom Language\"\n              value={customLanguage}\n              onChange={e => setCustomLanguage(e.target.value)}\n              sx={{ minWidth: 160, mb: 2 }}\n            />\n          )}\n        </Box>\n      </Box>\n      {/* Show scroll hint if needed, anchored to controls sidebar */}\n      {showScrollHint && (\n        <Box\n          sx={{\n            position: 'absolute',\n            bottom: 16,\n            right: 24,\n            zIndex: 10,\n            pointerEvents: 'none',\n          }}\n        >\n          <Box\n            sx={{\n              background: 'rgba(37, 99, 235, 0.9)',\n              color: 'white',\n              px: 2,\n              py: 0.5,\n              borderRadius: 2,\n              fontSize: 12,\n              fontWeight: 500,\n              animation: 'bounce 2s infinite',\n              boxShadow: '0 2px 8px rgba(0,0,0,0.12)',\n              pointerEvents: 'auto',\n            }}\n          >\n            â¬‡ï¸ More options below\n          </Box>\n        </Box>\n      )}\n      {/* Snackbar for success messages */}\n      <Snackbar\n        open={!!successMessage}\n        autoHideDuration={3000}\n        onClose={() => setSuccessMessage('')}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'left' }}\n      >\n        <Alert onClose={() => setSuccessMessage('')} severity=\"success\" sx={{ width: '100%' }}>\n          {successMessage}\n        </Alert>\n      </Snackbar>\n    </Box>\n    <Snackbar\n      open={showApiKeyError}\n      autoHideDuration={6000}\n      onClose={() => setShowApiKeyError(false)}\n      anchorOrigin={{ vertical: 'top', horizontal: 'center' }}\n    >\n      <Alert\n        elevation={6}\n        variant=\"filled\"\n        severity=\"error\"\n        sx={{ fontSize: 18, alignItems: 'center' }}\n        action={\n          <Button color=\"inherit\" size=\"small\" onClick={() => navigate('/settings')}>Go to Settings</Button>\n        }\n      >\n        AI features are unavailable. Please enter your Gemini API key in Settings (or check that your key is valid).\n      </Alert>\n    </Snackbar>\n    </>\n  );\n};\n\nexport default ConversationView; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}